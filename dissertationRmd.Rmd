---
title: "dissertation"
author: "Boiko Andrew"
date: '11 February 2021'
output:
  html_document:
    df_print: paged
  pdf_document:
    latex_engine: xelatex
keep_markdown: yes
keep_tex: yes
header-includes:
- \XeTeXdefaultencoding utf8
- \usepackage{xltxtra}
- \usepackage{fontspec}
- \setmainfont{Times New Roman}
- \setsansfont{Arial}
- \setmonofont{Courier New}
- \newfontfamily{\cyrillicfont}{Times New Roman}
- \newfontfamily{\cyrillicfonttt}{Courier New}
- \newfontfamily{\cyrillicfontsf}{Arial}
- \usepackage[english]{babel}
---

```{r knitr set, include = FALSE, eval = TRUE}
knitr::opts_chunk$set(echo = TRUE)
```

Remove all variables beforehand
```{r removing variables}
rm(list = ls())
```

Attach necessary packages
```{r attaching packages, echo = FALSE, message = FALSE}
library(rJava)
library(xlsx)
library(xts)
library(forecast)
library(dplyr)
library(rprojroot)
```

Set up working directory
```{r setup, include = FALSE, cache = FALSE}
#knitr::opts_knit$set(root.dir =
#                       "D:/Мои проекты/Диссертация/R Studio") # дома
knitr::opts_knit$set(root.dir =
                       "N:/Мои проекты/Диссертация/R Studio") # на работе
```

Read exchange rate from MS Excel file
```{r, echo = FALSE}
fileName <- "RC_F01_01_2009_T09_02_2021.xlsx"
dailyCourse <- read.xlsx(file = fileName, sheetName = "RC",
                         encoding = "UTF-8")
head(dailyCourse)
```

Rename necessary columns and look at head data
```{r, echo = TRUE}
colnames(dailyCourse)[colnames(dailyCourse) == "data"] <- "date"
colnames(dailyCourse)[colnames(dailyCourse) == "curs"] <- "rate"

dailyCourse$nominal <- NULL
dailyCourse$cdx <- NULL

head(dailyCourse)
```

Look at tail data
```{r}
tail(dailyCourse)
```

Calculate daily сourse and plot it
```{r}
dailyCourseXts <- xts(x = dailyCourse$rate,
                      order.by = dailyCourse$date)
plot(dailyCourseXts, main = "Daily course")
```

Monthly course (mean value calculated over days)
```{r}
monthlyCourseXts <- apply.monthly(dailyCourseXts, mean)
index(monthlyCourseXts) <- as.yearmon(index(monthlyCourseXts))
plot(monthlyCourseXts, main = "Monthly course")
```

Convert Xts object to time series object and plot it
```{r}
monthlyCourse <- ts(monthlyCourseXts, frequency = 12,
                    start = index(monthlyCourseXts)[1])
monthlyCourse <- monthlyCourse[ ,1]
plot(monthlyCourse, main = "Monthly course",
     xlab = "Years", ylab = "Course")
grid()
```

Make some auxilary calculations
```{r}
monthsQty <- as.integer(length(monthlyCourse))
yearsQty <- floor(length(monthlyCourse) / 12)
errorsQty <- 7 # ME, RMSE, MAE, MPE, MAPE, MASE, ACF1
```

# STL decomposition
Calculate number of differencings to convert time series into
stationary series in terms of seasonality
```{r}
nsdiffs(monthlyCourse)
```

Calculate number of ordinal differencings to convert time series into
stationary series in term of mean and variance
```{r}
ndiffs(monthlyCourse)
```

Plot the graph of time series over years
```{r seasonal plot}
seasonplot(monthlyCourse, 12, col = rainbow(12), year.labels = TRUE,
           main = "Seasonal plot")
grid()
```

Seasonal decomposition itself
```{r seasonal decomposition}
monthlyCourseStl <- stl(monthlyCourse, s.window = "periodic")
par(mfrow = c(1,1))
plot(monthlyCourseStl)
grid()
```

```{r trend plot}
plot(monthlyCourseStl$time.series[ , "trend"],
     xlab = "Years", ylab = "Stl trend component")
grid()

```

```{r seasonal component plot}
plot(monthlyCourseStl$time.series[ , "seasonal"],
     xlab = "Years", ylab = "Stl seasonal component")
grid()
```
``` {r remainder plot}
plot(monthlyCourseStl$time.series[ , "remainder"],
     xlab = "Years", ylab = "Stl remainder")
grid()
```

# Arima



